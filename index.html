<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note2Brain App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-button { border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-button.active { border-color: #4f46e5; color: #4f46e5; }
        .nav-link { transition: all 0.2s; }
        .nav-link.active { background-color: #4f46e5; color: white; }
    </style>
    <script type="module">
        // Import Supabase library
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        // --- Supabase Configuration ---
        const supabaseUrl = 'https://rktrtcrfosxlgobzrvan.supabase.co'
        const supabaseKey = 'sb_publishable_egHl917fuLwD3aDwSMcRGQ_DR9qtUdn'
        const supabase = createClient(supabaseUrl, supabaseKey)

        // --- Global State Variables ---
        let userId;
        let userDisplayName;
        let currentQuizData = [];
        let currentQuizIndex = 0;
        let examQuestions = [];
        let currentExamIndex = 0;
        let examAnswers = {};
        let userPerformance = { correct: 0, incorrect: 0, topicIssues: {} };
        let performanceChartInstance = null;
        let topicChartInstance = null;

        // --- UI Helper Functions ---
        const showMessage = (message, type = 'info') => {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            messageBox.className = 'fixed top-4 right-4 z-50 p-3 rounded-lg shadow-lg text-sm text-white ' + (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        };

        const setLoading = (isLoading, message = 'Processing...') => {
            const loadingOverlay = document.getElementById('loading-overlay');
            document.getElementById('loading-message').textContent = message;
            loadingOverlay.classList.toggle('hidden', !isLoading);
        };

        const setLoggedInState = (isLoggedIn) => {
            document.getElementById('login-page').classList.toggle('hidden', isLoggedIn);
            document.getElementById('dashboard-page').classList.toggle('hidden', !isLoggedIn);
        };
        
        // --- Gemini API Functions (Unchanged) ---
        const fetchTextFromVision = async (base64ImageData) => {
            setLoading(true, 'Extracting text from image...');
            const prompt = "Extract all text from the image, focusing on key concepts and important facts.";
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }, { inlineData: { mimeType: "image/png", data: base64ImageData } }] }] };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { setLoading(false); throw new Error(`API error: ${response.status}`); }
            const result = await response.json();
            setLoading(false);
            return result.candidates?.[0]?.content?.parts?.[0]?.text;
        };
        
        const fetchStructuredChatResponse = async (prompt, responseSchema) => {
            setLoading(true, 'Generating study materials...');
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema } };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { setLoading(false); throw new Error(`API error: ${response.status}`); }
            const result = await response.json();
            setLoading(false);
            return JSON.parse(result.candidates[0].content.parts[0].text);
        };
        
        // --- Core Application Logic ---
        const generateFlashcardsAndMCQs = async (notesText) => {
             try {
                const schema = { type: "OBJECT", properties: { flashcards: { type: "ARRAY", items: { type: "OBJECT", properties: { q: { "type": "STRING" }, a: { "type": "STRING" } } } }, mcqs: { type: "ARRAY", items: { type: "OBJECT", properties: { question: { "type": "STRING" }, options: { "type": "ARRAY", "items": { "type": "STRING" } }, correct: { "type": "STRING" } } } }, pyqs: { type: "ARRAY", items: { type: "OBJECT", properties: { question: { "type": "STRING" }, options: { "type": "ARRAY", "items": { "type": "STRING" } }, correct: { "type": "STRING" } } } } } };
                const prompt = `From the following text, extract all key concepts, definitions, and important facts. Generate a comprehensive set of flashcards (Q&A) and multiple-choice questions (with one correct answer and three distractors). Additionally, create a few relevant previous year questions (PYQs). Return all content in the specified JSON format. Text: ${notesText}`;
                const response = await fetchStructuredChatResponse(prompt, schema);
                if (!response?.flashcards || !response?.mcqs || !response?.pyqs) throw new Error('AI response was malformed.');
                return response;
            } catch (e) {
                showMessage(`AI processing failed: ${e.message}`, 'error');
                return null;
            }
        };
        
        const processFile = async (file) => {
            if (file.type === 'application/pdf') {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = async () => {
                        try {
                            setLoading(true, 'Reading PDF file...');
                            pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js`;
                            const pdf = await pdfjsLib.getDocument({ data: reader.result }).promise;
                            let text = '';
                            for (let i = 1; i <= pdf.numPages; i++) {
                                const page = await pdf.getPage(i);
                                const content = await page.getTextContent();
                                text += content.items.map(item => item.str).join(' ') + ' ';
                            }
                            setLoading(false);
                            resolve(text);
                        } catch (e) { setLoading(false); reject(new Error('Failed to read PDF.')); }
                    };
                    reader.onerror = () => reject(new Error('File reader error.'));
                    reader.readAsArrayBuffer(file);
                });
            } else if (file.type.startsWith('image/')) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = async () => {
                        try { resolve(await fetchTextFromVision(reader.result.split(',')[1])); } 
                        catch (e) { reject(new Error(`Image processing failed: ${e.message}`)); }
                    };
                    reader.onerror = () => reject(new Error('File reader error.'));
                    reader.readAsDataURL(file);
                });
            } else {
                throw new Error('Unsupported file type.');
            }
        };

        const handleSubmitNotes = async () => {
            const textTab = document.getElementById('text-input-tab');
            let notesText = '';

            if (!textTab.classList.contains('hidden')) {
                notesText = document.getElementById('notes-text').value;
            } else {
                const file = document.getElementById('file-input').files[0];
                if (!file) { showMessage('Please select a file to upload.', 'error'); return; }
                try { notesText = await processFile(file); } 
                catch (e) { showMessage(e.message, 'error'); return; }
            }

            if (!notesText?.trim()) { showMessage('Notes text is empty.', 'error'); return; }

            const results = await generateFlashcardsAndMCQs(notesText);
            if (results) {
                // --- SUPABASE: Save notes to the database ---
                try {
                    setLoading(true, 'Saving to database...');
                    const { error } = await supabase
                        .from('notes')
                        .insert([{ 
                            user_id: userId, 
                            notes: notesText.substring(0, 500) + '...', 
                            flashcards: results.flashcards,
                            mcqs: results.mcqs,
                            pyqs: results.pyqs
                        }]);
                    if (error) throw error;
                    showMessage('Notes processed and saved!', 'info');
                    document.getElementById('notes-text').value = '';
                    document.getElementById('file-input').value = '';
                    fetchAllNotes(); // Refresh notes
                } catch (e) {
                    showMessage(`Error saving data: ${e.message}`, 'error');
                } finally {
                    setLoading(false);
                }
            }
        };

        const fetchAllNotes = async () => {
            if(!userId) return;
            const { data, error } = await supabase
                .from('notes')
                .select('*')
                .eq('user_id', userId);
            
            if(error) {
                showMessage('Could not fetch your notes.', 'error');
                return;
            }

            const allContent = { flashcards: [], mcqs: [], pyqs: [] };
            data.forEach(note => {
                if(note.flashcards) allContent.flashcards.push(...note.flashcards);
                if(note.mcqs) allContent.mcqs.push(...note.mcqs);
                if(note.pyqs) allContent.pyqs.push(...note.pyqs);
            });
            renderFlashcards(allContent.flashcards);
            renderPyqs(allContent.pyqs);
        };
        
        // --- Rendering Functions (Unchanged) ---
        const renderFlashcards = (flashcards) => {
            const container = document.getElementById('flashcard-container');
            container.innerHTML = (!flashcards || flashcards.length === 0) ? 
                '<div class="col-span-full bg-white p-4 rounded-xl shadow-sm border"><h4 class="font-semibold">No flashcards found. Upload notes to get started.</h4></div>' :
                flashcards.map(card => `<div class="bg-white p-4 rounded-xl shadow-sm border cursor-pointer hover:shadow-md transition-shadow"><h4 class="font-semibold">Q: ${card.q}</h4><p class="hidden mt-2 text-slate-600">A: ${card.a}</p></div>`).join('');
            container.querySelectorAll('.bg-white').forEach(cardDiv => cardDiv.addEventListener('click', () => cardDiv.querySelector('p').classList.toggle('hidden')));
        };
        
        const renderPyqs = (pyqs) => {
            const container = document.getElementById('pyq-container');
            container.innerHTML = (!pyqs || pyqs.length === 0) ? 
                '<div class="bg-white p-4 rounded-xl shadow-sm border"><h4 class="font-semibold">No PYQs found.</h4></div>' :
                pyqs.map(pyq => `<div class="bg-white p-4 rounded-xl shadow-sm border"><h4 class="font-semibold">Q: ${pyq.question}</h4><div class="mt-2 text-slate-600">${pyq.options.map(o => `<span class="inline-block bg-slate-100 px-3 py-1 rounded-full text-sm font-medium mr-2 mb-2">${o}</span>`).join('')}</div><p class="mt-2 text-green-600 font-bold">Correct: ${pyq.correct}</p></div>`).join('');
        };

        // --- Quiz & Exam Logic (Adapted for Supabase) ---
        const getAllQuestions = async () => {
            if (!userId) return [];
            const { data, error } = await supabase
                .from('notes')
                .select('mcqs, pyqs')
                .eq('user_id', userId);

            if (error) return [];
            
            const allQuestions = [];
            data.forEach(note => {
                if (note.mcqs) allQuestions.push(...note.mcqs);
                if (note.pyqs) allQuestions.push(...note.pyqs);
            });
            return allQuestions;
        };

        const startQuiz = async () => { /* Unchanged */ };
        const renderQuizQuestion = (questionData) => { /* Unchanged */ };
        const handleQuizAnswer = (event) => { /* Unchanged */ };
        const nextQuestion = () => { /* Unchanged */ };
        const startExam = async () => { /* Unchanged */ };
        const renderExamQuestion = (index) => { /* Unchanged */ };
        const handleExamNext = () => { /* Unchanged */ };
        const submitExam = async () => { /* Unchanged */ };
        const renderExamResults = (score) => { /* Unchanged */ };

        // --- Analytics & Data (Adapted for Supabase) ---
        const updatePerformance = async (isCorrect, questionText) => {
            if (!userId) return;
            const topic = questionText.split(' ').slice(0, 3).join(' ');
            let newStats = { ...userPerformance };
            newStats.correct = (newStats.correct || 0) + (isCorrect ? 1 : 0);
            newStats.incorrect = (newStats.incorrect || 0) + (isCorrect ? 0 : 1);
            if (!isCorrect) {
                newStats.topicIssues[topic] = (newStats.topicIssues[topic] || 0) + 1;
            }
            // --- SUPABASE: Upsert performance stats ---
            const { error } = await supabase
                .from('performance')
                .upsert({ user_id: userId, ...newStats });
            if (error) console.error('Error updating performance:', error);
        };

        const renderAnalytics = async () => {
            if (!userId) return;
            // --- SUPABASE: Fetch performance stats ---
            const { data, error } = await supabase
                .from('performance')
                .select('*')
                .eq('user_id', userId)
                .single(); // We only expect one row per user

            userPerformance = data || { correct: 0, incorrect: 0, topicIssues: {} };
            renderAnalyticsCharts();
        };

        const renderAnalyticsCharts = () => { /* Unchanged */ };

        // --- Navigation & UI Setup (Unchanged) ---
        const navigateTo = (sectionId) => {
            document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`.nav-link[data-section="${sectionId}"]`).classList.add('active');
        };
        const updateInputTab = (tabName) => {
            document.querySelectorAll('#upload-section .tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabName).classList.remove('hidden');
            document.querySelectorAll('.input-tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.input-tab-button[data-tab="${tabName}"]`).classList.add('active');
        };
        
        // --- SUPABASE: Authentication Handlers ---
        const handleGoogleSignIn = async () => {
            const { error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
            });
            if (error) showMessage(`Google Sign-In failed: ${error.message}`, 'error');
        };
        
        const handleLogout = async () => {
            const { error } = await supabase.auth.signOut();
            if (error) showMessage(`Logout failed: ${error.message}`, 'error');
        };

        // --- Window Onload / App Initialization ---
        window.onload = async () => {
            // --- SUPABASE: Auth State Change Listener ---
            supabase.auth.onAuthStateChange((_event, session) => {
                if (session) {
                    userId = session.user.id;
                    userDisplayName = session.user.email;
                    document.getElementById('user-id-display').textContent = `ID: ${userId}`;
                    setLoggedInState(true);
                    navigateTo('home-section');
                    fetchAllNotes();
                    renderAnalytics();
                } else {
                    setLoggedInState(false);
                    userId = null;
                }
            });
            
            // --- Event Listeners ---
            document.getElementById('google-signin-btn').addEventListener('click', handleGoogleSignIn);
            // Removed anonymous sign-in for simplicity with Supabase
            document.getElementById('anon-signin-btn').classList.add('hidden'); 
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('submit-notes-btn').addEventListener('click', handleSubmitNotes);
            document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
            document.getElementById('next-question-btn').addEventListener('click', nextQuestion);
            document.getElementById('start-exam-btn').addEventListener('click', startExam);
            document.getElementById('exam-next-btn').addEventListener('click', handleExamNext);
            document.getElementById('exam-submit-btn').addEventListener('click', submitExam);
            document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', () => navigateTo(link.dataset.section)));
            document.querySelectorAll('.input-tab-button').forEach(button => button.addEventListener('click', () => updateInputTab(button.dataset.tab)));
            updateInputTab('text-input-tab');
        };
    </script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">
    <div id="message-box" class="fixed top-4 right-4 z-50 p-3 rounded-lg shadow-lg hidden"></div>
    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-70 flex items-center justify-center z-40 hidden">
        <div class="flex flex-col items-center"><svg class="animate-spin h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p id="loading-message" class="mt-4 text-indigo-600 font-medium">Processing...</p></div>
    </div>
    
    <!-- Login Page -->
    <div id="login-page" class="flex flex-col items-center justify-center min-h-screen text-center p-4">
        <h1 class="text-4xl md:text-5xl font-bold text-slate-900 mb-2">Note2Brain</h1>
        <p class="text-lg md:text-xl text-indigo-600 font-semibold mb-8">Your AI-powered study partner for JEE & NEET.</p>
        <div class="space-y-4 max-w-sm w-full mx-auto p-8 bg-white rounded-xl shadow-lg border border-slate-200">
            <button id="google-signin-btn" class="w-full py-3 bg-white text-slate-700 font-semibold rounded-lg shadow-sm border border-slate-300 hover:bg-slate-100 transition flex items-center justify-center"><svg class="w-5 h-5 mr-3" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"></path><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"></path><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238C29.211 35.091 26.715 36 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"></path><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.571l6.19 5.238C42.012 35.245 44 30.028 44 24c0-1.341-.138-2.65-.389-3.917z"></path></svg>Sign in with Google</button>
            <button id="anon-signin-btn" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition">Continue Anonymously</button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard-page" class="flex flex-col md:flex-row min-h-screen hidden">
        <!-- Sidebar Navigation -->
        <nav class="md:w-64 w-full bg-slate-800 text-white p-6 flex flex-col items-center md:items-start md:h-screen md:sticky top-0 shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-6 w-full text-center md:text-left">Note2Brain</h2>
            <div class="w-full space-y-2">
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition active" data-section="home-section">Home</button>
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition" data-section="flashcard-section">Flashcards</button>
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition" data-section="pyq-section">PYQs</button>
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition" data-section="quiz-section">Quiz</button>
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition" data-section="exam-mode-section">Exam Mode</button>
                <button class="nav-link w-full py-2 px-4 rounded-lg text-left hover:bg-slate-700 transition" data-section="analytics-section">Analytics</button>
            </div>
            <div class="mt-auto w-full pt-4">
                 <p id="user-id-display" class="text-xs text-slate-400 break-all mb-4"></p>
                 <button id="logout-btn" class="w-full py-2 px-4 rounded-lg text-left hover:bg-red-600 transition bg-red-500">Logout</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow p-6 md:p-10">
            <div id="home-section" class="content-section">
                <header class="text-center mb-8"><h1 class="text-4xl font-bold text-slate-900">Dashboard</h1><p class="text-lg text-slate-600 mt-2">Upload your notes to generate powerful study materials.</p></header>
                <section id="upload-section" class="mb-10 p-6 bg-white rounded-xl shadow-sm border border-slate-200 max-w-3xl mx-auto"><h2 class="text-2xl font-bold text-slate-900 mb-4">Upload Your Notes</h2><div class="flex justify-center mb-4 border-b border-slate-200"><button data-tab="text-input-tab" class="input-tab-button px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 active">Paste Text</button><button data-tab="file-upload-tab" class="input-tab-button px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600">Upload File</button></div><div id="text-input-tab" class="tab-content space-y-4"><textarea id="notes-text" class="w-full h-40 p-4 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Paste your notes here..."></textarea></div><div id="file-upload-tab" class="tab-content space-y-4 hidden"><input type="file" id="file-input" accept=".pdf,image/jpeg,image/png" class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"></div><button id="submit-notes-btn" class="w-full py-3 mt-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition">Process Notes</button></section>
            </div>
            <div id="flashcard-section" class="content-section hidden"><h2 class="text-3xl font-bold text-slate-900 mb-6">Your Flashcards</h2><div id="flashcard-container" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div></div>
            <div id="pyq-section" class="content-section hidden"><h2 class="text-3xl font-bold text-slate-900 mb-6">Previous Year Questions (PYQs)</h2><div id="pyq-container" class="space-y-4"></div></div>
            <div id="quiz-section" class="content-section hidden"><h2 class="text-3xl font-bold text-slate-900 mb-6">Quiz Yourself</h2><div class="bg-white p-6 rounded-xl shadow-sm border max-w-3xl mx-auto"><div id="quiz-question-container"><p class="text-lg text-slate-600">Start a quiz to practice.</p></div><div class="mt-6 flex justify-center"><button id="start-quiz-btn" class="py-2 px-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition">Start Quiz</button><button id="next-question-btn" class="py-2 px-6 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition hidden">Next Question</button></div></div></div>
            <div id="exam-mode-section" class="content-section hidden"><h2 class="text-3xl font-bold text-slate-900 mb-6">Exam Mode</h2><div id="exam-intro-container" class="bg-white p-6 rounded-xl shadow-sm border max-w-3xl mx-auto text-center"><p class="text-lg text-slate-600">Take a 10-question exam generated from your notes.</p><button id="start-exam-btn" class="w-full py-3 mt-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition">Start Exam</button></div><div id="exam-container" class="bg-white p-6 rounded-xl shadow-sm border max-w-3xl mx-auto hidden"><div id="exam-question-container"></div><div id="exam-results-container" class="hidden text-center"></div><div class="mt-6 flex justify-end"><button id="exam-next-btn" class="py-2 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition hidden">Next</button><button id="exam-submit-btn" class="py-2 px-4 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition hidden">Submit Exam</button></div></div></div>
            <div id="analytics-section" class="content-section hidden"><h2 class="text-3xl font-bold text-slate-900 mb-6">Your Performance</h2><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-sm border"><div class="h-80"><canvas id="performanceChart"></canvas></div><p class="mt-4 text-center text-slate-600">Overall performance from all quizzes.</p></div><div class="bg-white p-6 rounded-xl shadow-sm border"><div class="h-80"><canvas id="topicChart"></canvas></div><p class="mt-4 text-center text-slate-600">Topics needing more practice.</p></div></div></div>
        </main>
    </div>
    <footer class="text-center py-8 border-t border-slate-200 mt-10"><p class="text-slate-500 text-sm">Powered by Gemini AI and Supabase.</p></footer>
</body>
</html>

